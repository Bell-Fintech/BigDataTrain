package zd.request;

import java.io.IOException;
import java.sql.Connection;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;

import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import zd.request.MyDbUtils;

public class RequestDemo extends HttpServlet {
	private static final long serialVersionUID = 1L;

	Connection conn = null;
	Statement st = null;

	public void init() {
		try {
			conn = MyDbUtils.getConnection();
		} catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
		try {
			st = conn.createStatement();
		} catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
	}

	protected void service(HttpServletRequest request, HttpServletResponse response)
			throws ServletException, IOException {
		request.setCharacterEncoding("UTF-8");
		response.setCharacterEncoding("UTF-8");
		response.setContentType("text/html; charset=UTF-8");
		// 每次请求时创建一个request对象
		// 获取页面传递过来的参数
		String name = request.getParameter("username");
		String pass = request.getParameter("password");
		// System.out.println(name+","+pass);
		// 配置文件
		String sql = "insert into products values(null,'数据结构',12.09,'计算机',1000,'掌握，适用广')";
		int i = st.executeUpdate(sql);
		System.out.println(i);
		// 必须关闭 否则测试错误
		// 即使下面有错误 也可以执行 因为是单元测试
		MyDbUtils.release(conn, st, null);
		if (name != null && pass != null) {
			// 配置文件
			String sql = "select * from user";
			ResultSet set = st.executeQuery(sql);
			while (set.next()) {
				String id = set.getString("id");
				String name = set.getString(2);
				System.out.println(id + "=" + name);
			}
			MyDbUtils.release(conn, st, set);
		}

	}

}